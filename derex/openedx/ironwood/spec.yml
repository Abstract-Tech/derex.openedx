builder:
  class: derex.builder.builders.BuildahBuilder

source:
  type: derex-relative
  path: wheels

copy:
  assets.py: /tmp
  entrypoint.sh: /entrypoint.sh
  wsgi.py: /tmp/
  base.py: /tmp/
  restore_dump.py: /tmp/
  fixtures: /tmp/fixtures
  compile_assets.sh: /openedx/bin/
  cleanup_assets.sh: /openedx/bin/
  translations.sh: /openedx/bin/
  symlink_duplicates.py: /openedx/bin/

config:
  #cmd: gunicorn --name ${SERVICE_VARIANT} --bind=0.0.0.0:8000 --max-requests=1000 ${SERVICE_VARIANT}.wsgi:application
  cmd: sh -c "DEBUG=True ./manage.py ${SERVICE_VARIANT} runserver 0.0.0.0:8000"
  entrypoint: '["/entrypoint.sh"]'
  workingdir: /openedx/edx-platform
  env:
    CONFIG_ROOT: /openedx/config
    PATH: /openedx/bin:${PATH}
    SERVICE_VARIANT: lms
    SETTINGS: derex.base
    MYSQL_PASSWORD: secret
    EMAIL_HOST: smtp
    DEBUG: "True"
    DUMMY_INCR: "1"  # Increment to refresh image generation
build_env:
  - TRANSIFEX_USERNAME
  - TRANSIFEX_PASSWORD

scripts:
  - install_openedx.sh
  - install_custom.sh
  - prepare_assets.sh

dest: derex/openedx-ironwood
